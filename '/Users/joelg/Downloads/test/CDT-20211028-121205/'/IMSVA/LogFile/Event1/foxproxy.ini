# 1. This ini file should be stored in UTF-8 encoding.
# 2. Each line started with a pound sign is a comment. There shouldn't be any space or tab before the pound sign.
# 3. Some values can have K,M,G in the suffix. K means kilo, M means mega, while G means giga.
# 4. Modify this configuration file manually might cause malfunctions.

[admin]
# where foxproxy daemon should write the pid file
foxproxy_pid_file=/opt/trend/imss/config/foxproxy.pid

# If the temporary file is larger than this number, it will be dumped onto disk.
# You can use K, M, and G in this parameter ( 2K, 5M, or 1G )
mem_file_threshold=256K

# All the temp files will be kept if this flag is on
# 0 -> clean it after processing
# 1 -> keep it after processing
keep_tmp_file=0

# Temporary location to store milter data
tmp_path=/tmp

# 0 -> Linux Thread
# 1 -> POSIX Thread
# POSIX mode is ok for RedHat 9 and AS 3.0
# Solaris always uses POSIX mode
#thread_type=1
thread_type=0

# The number of permanent threads
thread_pool_size=1024
#thread_pool_size=1024

# The maximum size of job queue.
# max concurrent connection number = thread_pool_size + max_queue_size
max_queue_size=1024

scanner_id=1

[backend_server]
# backend_server_address=
backend_server_address=127.0.0.1
backend_server_port=10021

[proxy]
# proxy_more=0 -> dummy mode, doesn't have any knowledge on content
# proxy_mode=1 -> smtp mode, for FoxHunter
#proxy_mode=1

# socket timeout, in seconds
# 0 or empty means there is no timeout for socket operations
socket_timeout=120

# Empty means to bind to all interfaces
proxy_address=

proxy_port=10020

proxy_backlog=64

max_line_length=81920

[dns]
#used for IP Profiler PTR check: 0 means to use normal_dns_server_list dns settings. 1 means to use system dns settings.
normal_dns_use_system=1

normal_dns_retry=2

# The ip address of DNS server. If this value is empty, FoxProxy will use system DNS settings.
normal_dns_server_list=/opt/trend/imss/config/normal_dns_server.list

#used for IP Profiler local bind query: 0 means to use fox_dns_server_list dns settings. 1 means to use system dns settings.
fox_dns_use_system=0

fox_dns_retry=1

fox_dns_server_list=/opt/trend/imss/config/fox_dns_server.list

#used for ERS query
ers_dns_retry=2

# 0 means to use ers_dns_server_list dns settings. 1 means to use system dns settings.
ers_dns_use_system=1

# The ip address of ERS DNS server. If this value is empty, FoxProxy will use system DNS settings.
ers_dns_server_list=/opt/trend/imss/config/ers_dns_server.list

[fox_hunter]
# Use this parameter to filter out these commands in EHLO response
# ex: PIPELINING, 8BITMIME
# esmtp_excluded_command=PIPELINING
esmtp_excluded_command=

# Use this parameter to turn on/off incomplete message sending
#send_incomplete_msg=1

# HELO incomplete_msg_domain
incomplete_msg_domain=foxhunter

# MAIL FROM: incomplete_msg_sender
incomplete_msg_sender=postmaster@foxhunter

# RCPT TO: incomplete_msg_recipient
incomplete_msg_recipient=foxhunter_proxy@foxhunter.com
report_send_interval=300

# The list of excluded IP
# Usually a corporate has some mechanisms like watch dogs to monitor SMTP service
# Use this parameter to exclude these watch dogs
# ex: 10.2.15.60, 10.2.14.120
incomplete_msg_excluded_IP=

#session_start_tag=X-Trend-FH-Time-Received

#upstream_mta_ip_port_tag=X-Trend-FH-Upstream-MTA-IP-And-Port

#upstream_mta_ptr_tag=X-Trend-FH-Upstream-MTA-PTR

#session_info_tag=X-Trend-FH-Session

#rbl_info_backend_tag=X-Trend-FH-Backend-RBL-Domain

rbl_info_regex_list=/opt/trend/imss/config/rbl_info_regex.list

#rbl_info_proxy_tag=X-Trend-FH-Proxy-RBL-Result

# This is the upper bound for the number of invalid commands.
# Any invalid command coming after the number of invalid commands will be ignored.
invalid_command_threshold=30

# use this parameter to turn on ret replace in downstream SMTP return code
# 0 -> off
# 1 -> on
ret_replace=1

ret_replace_list=/opt/trend/imss/config/ret_replace.list

# Use this flag to turn on ptr record lookup
ptr_check=0

# The RBL domain on FoxDNS
#rbl_check_domain=all.foxhunter.trendmicro.com

# The check list, see the comments on rbl_check.list for more information
rbl_check_list=/opt/trend/imss/config/rbl_check.list

# The action for RBL check, if hit
# 0 -> reject (use rbl_check_smtp_return as return message)
# 1 -> pass (pass the request to the back-end MTA, log rbl_check_domain in message header)
#rbl_check_action=1

# The return code and message of the RBL check, if hit
#rbl_check_smtp_return=554 Service unavailable; Client host %CLIENT_IP% blocked using %RBL_CHECK_DOMAIN%

drop_temporary_response=421 Service not available,closing transmission channel
drop_permenant_response=554 Transaction failed

# The return code and return string from downstream, e.g, ERS return code and return string
# IP profiler will drop the connection when get the such return code and return string
# format: [return_code_1]:[return_string_1],[return_code_2]:[return_string_2]
# by default IP profiler will drop connection for ERS dropped connection
close_rbl_reply_list=450:blocked using Trend Micro Email Reputation Service,550:blocked using Trend Micro RBL+

[logs]
# log_level=0 -> turn off everything
# log_level=1 -> essential general log
# log_level=2 -> more general log and some debug log
# log_level=3 -> general log and debug log. It also disable internal log cache.
# log_level=4 -> very verbose
log_level=3

# The internal cache size of the logger, only used by general logger 
# You can use K, M, and G in this parameter ( 2K, 5M, or 1G )
internal_cache_size=4K

# The maximum size of each individual log file
# 10M means the size of each log file can't exceed 10M
# 0 means don't split the log file within the same day
# You can use K, M, and G in this parameter ( 2K, 5M, or 1G )
slice_size=20M

# turn on/off log purge
log_purge=1

# log_purge_num=7 and log_purge_unit=0 means to purge whatever logs older than 7 days
log_purge_num=7

# 0: days
# 1: weeks
# 2: months
log_purge_unit=0

# where all the log files should be written to
log_path=/opt/trend/imss/log

# foxproxy log prefix
#foxproxy_general_log_prefix=foxproxy-general
#foxproxy_debug_log_prefix=foxproxy-debug

#following configurations used for IP Profiler
[ip_profiler]
ip_profiler_enabled=0


#following configurations used for ERS
[ers]

#ers is enable or not
ers_enabled=0

#ers cache mechanism
cache_enabled=1

#expiration time of ers cache,unit is minutes
cache_live_time=5

#max ip count of ers cache
cache_max_count=10000

#ers query option:(1)"advance" means will query ERS RBL and QIL zone (2)"standard" means will query ERS RBL zone; customer can configure this settings in admin UI
ers_standard_advance_option=advance

#if this setting=yes,mean use default QIL blocked message from template configured in [rbl_reply_maps], this customer can configure this settings in admin UI
rbl_reply_map_use_default=no

#if this setting=yes,mean use default RBL blocked message from template configured in [rbl_reply_maps], this customer can configure this settings in admin UI
rbl_reply_map_use_standard_default=yes

#customized error code and error message,these settings will reply(partially) QIL blocked message from template configured in [rbl_reply_maps], this customer can configure this settings in admin UI
rbl_reply_map_user=450,Service unavailable

#customized error code and error message,these settings will reply(partially) RBL blocked message from template configured in [rbl_reply_maps], this customer can configure this settings in admin UI
rbl_reply_map_user_standard=550,error message

#suffix of ERS query string,for example: <reverse IP>.<AC>.r.mail-abuse.com
r_zone_name=r.mail-abuse.com
q_zone_name=q.mail-abuse.com

#IPs which need not to query ERS and recored connection log,such as:127.0.0.1;the difference between it and ERS approved list is that the IP in approved list need to record connection log for mail traffic statistics
permitted_IP=127.0.0.1

#default blocking response message template for RBL and QIL
rbl_reply_maps=imss_rbl_reply

#default blocking code for RBL
ERSReturnCodeOfRBL=127.1.0.1,127.1.0.2,127.1.0.3,127.1.0.4,127.1.0.5,127.1.0.6,127.1.0.7,127.1.0.8,127.1.0.9,127.1.0.10,127.1.0.11,127.1.0.12,127.1.0.13,127.1.0.14,127.1.0.15,127.0.0.64,127.0.0.65,127.0.0.66

#default blocking code for QIL
ERSReturnCodeOfQILRBL=127.0.0.32,127.0.0.33,127.0.0.34,127.0.0.35,127.0.0.36,127.0.0.37,127.0.0.38,127.0.0.39,127.0.0.40,127.0.0.41,127.0.0.42,127.0.0.43,127.0.0.44,127.0.0.45,127.0.0.46,127.0.0.47,127.0.0.64,127.0.0.65,127.0.0.66

ERSAcNotReady=ERS is unavailable now as the AC may not be ready on Trend Micro's ERS server. ERS will not be available until ERS server has synchronized this AC with the Product License Server. Please wait for two hours before checking the Email Reputation again.
ERSDNSError=The IP address of DNS server in network setting is incorrect, so the ERS could not work well. Please correct the DNS server setting in order to employ ERS.

#the interval for FoxProxy write ERS log to CSV file(/opt/trend/imss/log/ers.imss.xxxxxxxx.xxxx)
log_record_interval=300

[internal_host]
internal_host_enabled=0
